try{var BrowserAgentExtension={init:function(){BrowserAgentUtils.metricUtils.addMetricType("misc",BrowserAgentExtension.extAddCustomMiscMetric);BrowserAgentExtension.extCollectMiscMetrics()},extJSFuncMap:{},extAddJSFuncToInstrument:function(){for(var a in BrowserAgentExtension.extJSFuncMap)BrowserAgentUtils.funcUtils.addFuncToGlobalsInstrumentMap(a,BrowserAgentExtension.extJSFuncMap[a])},extCustomPageMetricMap:{},extAddCustomPageMetric:function(){},extCustomJSFuncMetricMap:{},extAddCustomJSFuncMetric:function(){},
extCustomAjaxMetricMap:{},extAddCustomAjaxMetric:function(){},extCustomMiscMetricMap:{},extCollectMiscMetrics:function(){BrowserAgentUtils.metricUtils.harvestMetrics(BrowserAgentGlobals.metricType.MISC)},extAddCustomMiscMetric:function(){var a="",b="MISC",d=BrowserAgentGlobals.UNDEFINED;BrowserAgentGlobals.bs===BrowserAgentGlobals.UNDEFINED&&(d=b=BrowserAgentUtils.metricUtils.convertURL(BrowserAgentUtils.metricUtils.sanitizeURL(BrowserAgentGlobals.currentURL)),b+=BrowserAgentGlobals.pipeChar+"MISC");
for(var c in BrowserAgentExtension.extCustomMiscMetricMap)a+=BrowserAgentUtils.metricUtils.constructMetricPath(b,c,BrowserAgentExtension.extCustomMiscMetricMap[c][0],BrowserAgentExtension.extCustomMiscMetricMap[c][1]);0<a.length&&(a=BrowserAgentUtils.metricUtils.placeInPostParameterFormat(BrowserAgentGlobals.bs,BrowserAgentGlobals.bt,BrowserAgentGlobals.btc,d,"",a),BrowserAgentGlobals.bCount++);return a},extAddCustomOptionalProperty:function(){return""},extNameFormatter:function(a){return a}};var BrowserAgentMinHeap=function(a){this._items=[];this._size=0;this._getLeftChildIndex=function(a){return 2*a+1};this._getRightChildIndex=function(a){return 2*a+2};this._getParentIndex=function(a){return Math.ceil(a/2)-1};this._compareItems=a||function(a,c){return a===c?0:a<c?-1:1};this._heapify=function(a){var c=this._getLeftChildIndex(a),d=this._getRightChildIndex(a),e=a;this._size>c&&0>this._compareItems(this._items[c],this._items[e])&&(e=c);this._size>d&&0>this._compareItems(this._items[d],
this._items[e])&&(e=d);e!=a&&(c=this._items[e],this._items[e]=this._items[a],this._items[a]=c,this._heapify(e))};this._sift=function(a){var c=this._getParentIndex(a);if(0<=c&&0<this._compareItems(this._items[c],this._items[a])){var d=this._items[c];this._items[c]=this._items[a];this._items[a]=d;this._sift(c)}}},BrowserAgentSet=function(){this._items={};this._size=0};BrowserAgentSet.prototype={add:function(a){this.contains(a)||(this._items[JSON.stringify(a)]=a,this._size++)},contains:function(a){return"undefined"!==
typeof this._items[JSON.stringify(a)]},isEmpty:function(){return 0===this._size},remove:function(a){this.contains(a)&&(delete this._items[JSON.stringify(a)],this._size--)},length:function(){return this._size}};BrowserAgentMinHeap.prototype={isEmpty:function(){return 0===this._size},getMin:function(){return this.isEmpty()?null:this._items[0]},length:function(){return this._size},pop:function(){if(this.isEmpty())return null;if(1===this._size)return this._size--,this._items.pop();var a=this._items[0];
this._items[0]=this._items.pop();this._heapify(0);this._size--;return a},push:function(a){this._items.push(a);this._sift(this._items.length-1);this._size++}};var BrowserAgentLogger={logPrefix:" [APM BrowserAgent]: ",logLevelPrefix:{DEBUG:" [DEBUG] ",ERROR:" [ERROR] ",INFO:" [INFO] ",WARN:" [WARN] "},debug:function(a){BrowserAgentLogger.isOk()&&window.console.log(BrowserAgentUtils.timeUtils.getCurrTime()+BrowserAgentLogger.logPrefix+BrowserAgentLogger.logLevelPrefix.DEBUG+a)},error:function(a){BrowserAgentLogger.isOk()&&
window.console.log(BrowserAgentUtils.timeUtils.getCurrTime()+BrowserAgentLogger.logPrefix+BrowserAgentLogger.logLevelPrefix.ERROR+a)},info:function(a){BrowserAgentLogger.isOk()&&window.console.log(BrowserAgentUtils.timeUtils.getCurrTime()+BrowserAgentLogger.logPrefix+BrowserAgentLogger.logLevelPrefix.INFO+a)},isOk:function(){return window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_BROWSERLOGGINGENABLED]&&window.console&&"object"==typeof window.console?!0:!1},warn:function(a){BrowserAgentLogger.isOk()&&
window.console.log(BrowserAgentUtils.timeUtils.getCurrTime()+BrowserAgentLogger.logPrefix+BrowserAgentLogger.logLevelPrefix.WARN+a)}},BrowserAgentUtils={BrowserAgentTimer:null,init:function(){BrowserAgentUtils.BrowserAgentTimer=BrowserAgentUtils.timeUtils.getTimerObj();BrowserAgentUtils.configUtils.init();BrowserAgentUtils.configUtils.isPageExcluded?BrowserAgentLogger.info("Skipping all instrumentation because page is configured to be EXCLUDED."):(BrowserAgentUtils.browserUtils.init(),BrowserAgentUtils.cookieUtils.init(),
BrowserAgentUtils.funcUtils.init(),BrowserAgentUtils.metricUtils.init())},browserUtils:{CorBrowsGUID:null,geoCookie:null,platform:-1,platformVer:-1,TTFlag:0,unknownPlatform:"Unsupported",unknownPlatformVer:"X",init:function(){if(navigator&&navigator.userAgent){var a=this.getBrowserInfo(navigator.userAgent);BrowserAgentGlobals.p=a.name;BrowserAgentGlobals.pv=a.version}else BrowserAgentLogger.warn("browserUtils.init : navigator object is not found"),BrowserAgentGlobals.p=this.unknownPlatform,BrowserAgentGlobals.pv=
this.unknownPlatformVer;window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_GEOENABLED]&&this.getGeoLocation()},getBrowserInfo:function(a){function b(b){return(b=a.match(b))&&1<b.length&&(b=b[1].split("."))&&0<b.length?b[0]:this.unknownPlatformVer}var c=this.unknownPlatform,d=this.unknownPlatformVer;if(!a)return BrowserAgentLogger.warn("getBrowserInfo : User Agent is not found."),{name:c,version:d};/opera|opr/i.test(a)||(/edge/i.test(a)?(c=BrowserAgentGlobals.platformNames.EDGE,d=b(/(?:edge)\/(\d+(\.\d+)?)/i)):
/msie|trident/i.test(a)?(c=BrowserAgentGlobals.platformNames.IE,d=b(/(?:msie |rv:)(\d+(\.\d+)?)/i)):/chrome|crios|crmo/i.test(a)?(c=BrowserAgentGlobals.platformNames.CHROME,d=b(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)):/firefox|iceweasel/i.test(a)?(c=BrowserAgentGlobals.platformNames.FIREFOX,d=b(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)):/safari/i.test(a)&&(c=BrowserAgentGlobals.platformNames.SAFARI,d=b(/version\/(\d+(\.\d+)?)/i)));return{name:c,version:d}},getGeoLocation:function(){if(!navigator||
!navigator.geolocation)BrowserAgentLogger.warn("getGeoLocation : Geolocation is not supported in this browser."),BrowserAgentUtils.cookieUtils.updateCookie(BrowserAgentUtils.cookieUtils.cookies.GEO,{lat:-255,"long":-255});else if(!BrowserAgentUtils.cookieUtils.getCookieObject(BrowserAgentUtils.cookieUtils.cookies.GEO)){var a=window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_GEOTIMEOUT];navigator.geolocation.getCurrentPosition(this.geoLocationFound,this.geoLocationNotFound,{timeout:a,maximumAge:window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_GEOMAXIMUMAGE],
enableHighAccuracy:window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_GEOHIGHACCURACYENABLED]});setTimeout(function(){BrowserAgentUtils.cookieUtils.getCookieObject(BrowserAgentUtils.cookieUtils.cookies.GEO)||(BrowserAgentLogger.warn("getGeoLocation: never received a response for Geolocation. Setting co-ordinates to -255,-255."),BrowserAgentUtils.cookieUtils.updateCookie(BrowserAgentUtils.cookieUtils.cookies.GEO,{lat:-255,"long":-255}))},parseInt(a)+5E3)}},geoLocationFound:function(a){BrowserAgentUtils.cookieUtils.updateCookie(BrowserAgentUtils.cookieUtils.cookies.GEO,
{lat:a.coords.latitude,"long":a.coords.longitude})},geoLocationNotFound:function(a){switch(a.code){case a.PERMISSION_DENIED:BrowserAgentLogger.warn("geoLocationNotFound : Browser indicates that user denied the request for Geolocation.");break;case a.POSITION_UNAVAILABLE:BrowserAgentLogger.warn("geoLocationNotFound : Browser's Geolocation information is unavailable.");break;case a.TIMEOUT:BrowserAgentLogger.warn("geoLocationNotFound : Browser's request to obtain Geolocation timed out.");break;default:BrowserAgentLogger.warn("geoLocationNotFound : An unknown error occurred while browser attempted Geolocation.")}BrowserAgentUtils.cookieUtils.updateCookie(BrowserAgentUtils.cookieUtils.cookies.GEO,
{lat:-255,"long":-255})}},configUtils:{configNames:{BROWSERAGENT_AJAXMETRICSENABLED:"BROWSERAGENT_AJAXMETRICSENABLED",BROWSERAGENT_AJAXMETRICSTHRESHOLD:"BROWSERAGENT_AJAXMETRICSTHRESHOLD",BROWSERAGENT_BROWSERLOGGINGENABLED:"BROWSERAGENT_BROWSERLOGGINGENABLED",BROWSERAGENT_ENABLED:"BROWSERAGENT_ENABLED",BROWSERAGENT_EXCLUDELIST:"BROWSERAGENT_EXCLUDELIST",BROWSERAGENT_GEOENABLED:"BROWSERAGENT_GEOENABLED",BROWSERAGENT_GEOHIGHACCURACYENABLED:"BROWSERAGENT_GEOHIGHACCURACYENABLED",BROWSERAGENT_GEOMAXIMUMAGE:"BROWSERAGENT_GEOMAXIMUMAGE",
BROWSERAGENT_GEOTIMEOUT:"BROWSERAGENT_GEOTIMEOUT",BROWSERAGENT_INCLUDELIST:"BROWSERAGENT_INCLUDELIST",BROWSERAGENT_JSFUNCTIONMETRICSENABLED:"BROWSERAGENT_JSFUNCTIONMETRICSENABLED",BROWSERAGENT_JSFUNCTIONMETRICSTHRESHOLD:"BROWSERAGENT_JSFUNCTIONMETRICSTHRESHOLD",BROWSERAGENT_METRICFREQUENCY:"BROWSERAGENT_METRICFREQUENCY",BROWSERAGENT_PAGELOADMETRICSENABLED:"BROWSERAGENT_PAGELOADMETRICSENABLED",BROWSERAGENT_PAGELOADMETRICSTHRESHOLD:"BROWSERAGENT_PAGELOADMETRICSTHRESHOLD",BROWSERAGENT_URLMETRICOFF:"BROWSERAGENT_URLMETRICOFF",
BROWSERAGENT_WILYURL:"BROWSERAGENT_WILYURL",BROWSERAGENT_TTSTARTTIMEADJUSTMENTENABLED:"BROWSERAGENT_TTSTARTTIMEADJUSTMENTENABLED"},defaults:{BROWSERAGENT_AJAXMETRICSENABLED:!0,BROWSERAGENT_AJAXMETRICSTHRESHOLD:10,BROWSERAGENT_BROWSERLOGGINGENABLED:!1,BROWSERAGENT_ENABLED:!0,BROWSERAGENT_EXCLUDELIST:[],BROWSERAGENT_GEOENABLED:!1,BROWSERAGENT_GEOHIGHACCURACYENABLED:!1,BROWSERAGENT_GEOMAXIMUMAGE:1E4,BROWSERAGENT_GEOTIMEOUT:5E3,BROWSERAGENT_INCLUDELIST:[],BROWSERAGENT_JSFUNCTIONMETRICSENABLED:!1,BROWSERAGENT_JSFUNCTIONMETRICSTHRESHOLD:10,
BROWSERAGENT_METRICFREQUENCY:0,BROWSERAGENT_PAGELOADMETRICSENABLED:!0,BROWSERAGENT_PAGELOADMETRICSTHRESHOLD:10,BROWSERAGENT_URLMETRICOFF:!1,BROWSERAGENT_WILYURL:window.location.protocol+"//"+window.location.host+window.location.pathname+"?WilyCmd=cmdMetrics",BROWSERAGENT_TTSTARTTIMEADJUSTMENTENABLED:!0},init:function(){for(var a in BrowserAgentUtils.configUtils.configNames)window[a]=BrowserAgentUtils.configUtils.getConfig(a);BrowserAgentUtils.configUtils.isPageExcluded=BrowserAgentUtils.configUtils.isExcluded(BrowserAgentGlobals.currentFullURL)},
isPageExcluded:!1,getConfig:function(a){return a&&"string"==typeof a&&this.configNames[a]?null!=window[a]&&void 0!=window[a]?window[a]:BrowserAgentUtils.configUtils.defaults[a]:(BrowserAgentLogger.warn("getConfig : Could not obtain configuration for invalid parameter [ "+a+" ]"),null)},getFullURL:function(a){if(a&&"string"===typeof a){var b=document.createElement("a");b.href=a;return b.href}BrowserAgentLogger.warn("getFullURL : Not a valid URL. Skipping parse...")},isExcluded:function(a){if(!a||"string"!==
typeof a)return BrowserAgentLogger.warn("isExcluded: Not a valid URL. Skipping exclusion check..."),!1;var b=window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_INCLUDELIST],c=window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_EXCLUDELIST];return 0<c.length&&BrowserAgentUtils.configUtils.isUrlInRegexList(a,c)||0<b.length&&!BrowserAgentUtils.configUtils.isUrlInRegexList(a,b)?!0:!1},isUrlInRegexList:function(a,b){for(var c=0;c<b.length;c++)if((new RegExp(b[c])).test(a))return!0;
return!1}},cookieUtils:{cookies:{BTRESP:"x-apm-brtm-response-bt",BTRESPID:"x-apm-brtm-response-bt-id",BTPAGERESP:"x-apm-brtm-response-bt-page",GEO:"x-apm-brtm-geo",GLOBAL:"WMRUMC",PLATFORM:"x-apm-brtm-bt-p",PLATFORMVER:"x-apm-brtm-bt-pv",SNIPPET:"x-apm-brtm-snippet",URL:"x-apm-brtm-bt-url"},cookieKeys:{apmStartTimeChar:"startTime",bsChar:"bs",btChar:"bt",btcChar:"btc",CorBrowsGUIDChar:"CorBrowsGUID",geoChar:"g",platformChar:"p",platformVerChar:"pv",ttChar:"c"},document:document,init:function(){},
deleteCookie:function(a,b,c){a?this.document.cookie=a+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:""):BrowserAgentLogger.warn("deleteCookie : Cannot delete cookie by name "+a)},getCookie:function(a){var b="";if(!a)return BrowserAgentLogger.warn("getCookie : Cannot obtain cookie - "+a),b;for(var c=document.cookie.split("; "),d=0;d<c.length;d++){var e=c[d].split("=");e[0]==a&&(b=e[1])}return decodeURIComponent(b)},getCookieObject:function(a){return a?JSON.parse(this.getRawCookie(a)):
JSON.parse(this.getRawCookie(this.cookies.GLOBAL))},getRawCookie:function(a){if(!a)return BrowserAgentLogger.warn("getRawCookie : Cannot obtain cookie "+a),null;if(0<this.document.cookie.length){var b=this.document.cookie.indexOf(a+"=");if(-1!==b)return b=b+a.length+1,a=this.document.cookie.indexOf(";",b),-1===a&&(a=this.document.cookie.length),decodeURIComponent(this.document.cookie.substring(b,a))}return null},tokenizeCookieIntoMap:function(a,b){var c={};if(!a||!b)return BrowserAgentLogger.warn("tokenizeCookieIntoMap : Cannot parse "+
a+" by "+b),c;a=decodeURIComponent(a).replace(/["]/g,"");for(var d=a.split(b),e=0;e<d.length;e++){var f=d[e].split("=");2===f.length&&(c[f[0]]=f[1])}return c},setRawCookie:function(a,b,c,d,e){if(a){var f=new Date(BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch()+1E3*c);this.document.cookie=a+"="+encodeURIComponent(b)+(c?"; expires="+f.toUTCString():"")+(e?"; domain="+e:"")+(d?"; path="+d:"")}else BrowserAgentLogger.warn("setRawCookie : Cannot set cookie with name "+a)},setBrowserAgentGlobalDataCookie:function(){BrowserAgentUtils.cookieUtils.setRawCookie(BrowserAgentUtils.cookieUtils.cookies.PLATFORM,
BrowserAgentGlobals[BrowserAgentUtils.cookieUtils.cookieKeys.platformChar],null,BrowserAgentGlobals.forwardSlashChar,null);BrowserAgentUtils.cookieUtils.setRawCookie(BrowserAgentUtils.cookieUtils.cookies.PLATFORMVER,BrowserAgentGlobals[BrowserAgentUtils.cookieUtils.cookieKeys.platformVerChar],null,BrowserAgentGlobals.forwardSlashChar,null);BrowserAgentUtils.cookieUtils.setRawCookie(BrowserAgentUtils.cookieUtils.cookies.URL,BrowserAgentGlobals.forwardSlashChar,null,BrowserAgentGlobals.forwardSlashChar,
null)},setSelfInstrumentedCookie:function(a){null==a||void 0==a||"string"!=typeof a?BrowserAgentLogger.warn("setSelfInstrumentedCookie : "+a+" must be a string."):"false"===a?(BrowserAgentLogger.info("Removing self-instrumented flag..."),window.Storage&&sessionStorage.removeItem(window.location.pathname)):(BrowserAgentLogger.info("Setting self-instrumented flag to "+a),window.Storage&&sessionStorage.setItem(window.location.pathname,"true"))},updateCookie:function(a,b){if(a){var c=JSON.parse(this.getRawCookie(a)),
d={},e;for(e in c)d[e]=c[e];for(var f in b)null!=b[f]?d[f]=b[f]:delete d[f];this.setRawCookie(a,JSON.stringify(d),null,"/",null)}else BrowserAgentLogger.warn("updateCookie : cannot update cookie with name "+a)},updateObjWithCookieDataAjax:function(a,b){if(a&&b&&"object"===typeof a&&"object"===typeof b){var c,d,e;for(e in BrowserAgentUtils.cookieUtils.cookieKeys)if(c=BrowserAgentUtils.cookieUtils.cookieKeys[e],a[c])switch(d=decodeURIComponent(a[c]),c){case BrowserAgentUtils.cookieUtils.cookieKeys.CorBrowsGUIDChar:b[c]=
d;break;case BrowserAgentUtils.cookieUtils.cookieKeys.bsChar:b[c]=d===BrowserAgentGlobals.UNDEFINED?BrowserAgentGlobals[c]:d;break;case BrowserAgentUtils.cookieUtils.cookieKeys.btChar:b[c]=d===BrowserAgentGlobals.UNDEFINED?BrowserAgentGlobals[c]:d;break;case BrowserAgentUtils.cookieUtils.cookieKeys.btcChar:b[c]=d===BrowserAgentGlobals.UNDEFINED?BrowserAgentGlobals[c]:d;break;default:b[c]=d}}else BrowserAgentLogger.warn("updateObjWithCookieDataAjax : cannot update object with data from cookie")},updateObjWithCookieDataPage:function(a){if(a&&
"object"===typeof a){var b,c;for(c in BrowserAgentUtils.cookieUtils.cookieKeys)b=BrowserAgentUtils.cookieUtils.cookieKeys[c],a[b]&&(BrowserAgentGlobals[b]=decodeURIComponent(a[b]))}else BrowserAgentLogger.warn("updateObjWithCookieDataPage : cannot update object with data from cookie")}},funcUtils:{init:function(){try{this.addFuncToGlobalsInstrumentMap("XHR_Open",{name:"XMLHttpRequest.prototype.open"}),this.addFuncToGlobalsInstrumentMap("XHR_Send",{name:"XMLHttpRequest.prototype.send"}),BrowserAgentExtension&&
BrowserAgentExtension.extAddJSFuncToInstrument(),this.instrumentAllFunc()}catch(a){BrowserAgentLogger.error("funcUtils.init : "+a.message)}},addFuncToGlobalsInstrumentMap:function(a,b){a&&"string"===typeof a&&b&&"object"===typeof b?b.name&&"string"===typeof b.name?Object.defineProperty(BrowserAgentGlobals.functionsToInstrument,a,{value:b,writable:!0,enumerable:!0,configurable:!0}):BrowserAgentLogger.warn("addFuncToGlobalsInstrumentMap: value does not contain the mandatory field 'name'"):BrowserAgentLogger.warn("addFuncToGlobalsInstrumentMap: could not add JS Function because key or value is not of the correct type")},
endTrace:function(){return BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch()},instrumentFunc:function(a,b,c){if(!BrowserAgentGlobals.functionsToInstrument)return BrowserAgentLogger.info("Nothing to instrument."),null;if(!a||"string"!==typeof a||!b)return BrowserAgentLogger.warn("instrumentFunc: Function name was not specified. Skipping instrumentation..."),null;try{eval("var origObjFromWindow = (window."+a+") ? window."+a+" : null;")}catch(g){if(null==c||void 0==c)c=5;0>c?BrowserAgentLogger.warn("instrumentFunc: JS Function ["+
a+"] could not be instrumented."):(BrowserAgentLogger.info("Retrying instrumentation for JS Function ["+a+"]..."),setTimeout(function(){BrowserAgentUtils.funcUtils.instrumentFunc(a,b,c-1)},5E3));return null}if(!origObjFromWindow)return BrowserAgentLogger.warn(a+"instrumentFunc: could not be found in the browser window scope. Skipping instrumentation..."),null;if(origObjFromWindow._isBrowserAgentInstrumented)return BrowserAgentLogger.info(a+" already instrumented. Skipping instrumentation..."),null;
this.saveOrigObj(b,origObjFromWindow);if(!BrowserAgentGlobals.origFuncMap||!BrowserAgentGlobals.origFuncMap[b])return BrowserAgentLogger.warn("instrumentFunc: JS Function ["+a+"] could not be saved. Skipping instrumentation..."),null;var d=origObjFromWindow,e=!1;BrowserAgentLogger.info("Instrumenting "+a);var f=null;switch(a){case "XMLHttpRequest.prototype.send":f=function(){var a=this._fullURL,c=this._async,f=!1,q=this._isAjaxInstrumented,h={};try{f=window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_JSFUNCTIONMETRICSENABLED]}catch(r){e=
!0,BrowserAgentLogger.error("instrumentFunc (Checkpoint # 1): "+r.message)}if(!e&&c&&q){var k={},p="_"+Math.random().toString(36).substr(2,9),t=this.onload;t&&(this.onload=function(){try{e||(k[BrowserAgentGlobals.timestampNames.CALLBACK_START_TIME]=BrowserAgentUtils.funcUtils.startTrace())}catch(b){e=!0,BrowserAgentLogger.error("instrumentFunc (Checkpoint # 2): "+b.message)}t.apply(this,arguments);try{if(!e){k[BrowserAgentGlobals.timestampNames.CALLBACK_END_TIME]=BrowserAgentUtils.funcUtils.endTrace();
k.URL=a;var c=BrowserAgentUtils.cookieUtils.getRawCookie(BrowserAgentUtils.cookieUtils.cookies.BTRESP+"-"+p);if(c){var d=BrowserAgentUtils.cookieUtils.tokenizeCookieIntoMap(c,",");BrowserAgentUtils.cookieUtils.updateObjWithCookieDataAjax(d,k)}BrowserAgentUtils.cookieUtils.deleteCookie(BrowserAgentUtils.cookieUtils.cookies.BTRESP+"-"+p,"/",null);BrowserAgentUtils.metricUtils.addDataPoint(BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.AJAX],p,k);BrowserAgentUtils.metricUtils.harvestMetrics(BrowserAgentGlobals.metricType.AJAX,
p)}}catch(b){e=!0,BrowserAgentLogger.error("instrumentFunc (Checkpoint # 3): "+b.message)}});var u=this.onreadystatechange;this.onreadystatechange=function(){var b;try{e||(b=parseInt(BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch()),this.readyState===this.LOADING&&(k[BrowserAgentGlobals.timestampNames.FIRST_BYTE]||(k[BrowserAgentGlobals.timestampNames.FIRST_BYTE]=b)),this.readyState===this.DONE&&(k[BrowserAgentGlobals.timestampNames.LAST_BYTE]=b))}catch(c){e=!0,BrowserAgentLogger.error("instrumentFunc (Checkpoint # 4): "+
c.message)}if(u){try{e||this.readyState!==this.DONE||(k[BrowserAgentGlobals.timestampNames.CALLBACK_START_TIME]=BrowserAgentUtils.funcUtils.startTrace())}catch(c){e=!0,BrowserAgentLogger.error("instrumentFunc (Checkpoint # 5): "+c.message)}u.apply(this,arguments);try{if(!e&&this.readyState===this.DONE){k[BrowserAgentGlobals.timestampNames.CALLBACK_END_TIME]=BrowserAgentUtils.funcUtils.endTrace();var d=BrowserAgentUtils.cookieUtils.getRawCookie(BrowserAgentUtils.cookieUtils.cookies.BTRESP+"-"+p);if(d){var f=
BrowserAgentUtils.cookieUtils.tokenizeCookieIntoMap(d,",");BrowserAgentUtils.cookieUtils.updateObjWithCookieDataAjax(f,k)}BrowserAgentUtils.cookieUtils.deleteCookie(BrowserAgentUtils.cookieUtils.cookies.BTRESP+"-"+p,"/",null);k.URL=a;BrowserAgentUtils.metricUtils.addDataPoint(BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.AJAX],p,k);BrowserAgentUtils.metricUtils.harvestMetrics(BrowserAgentGlobals.metricType.AJAX,p)}}catch(c){e=!0,BrowserAgentLogger.error("instrumentFunc (Checkpoint # 6): "+
c.message)}}}}try{!e&&f&&(h[BrowserAgentGlobals.timestampNames.START_TIME]=BrowserAgentUtils.funcUtils.startTrace()),!e&&c&&q&&BrowserAgentUtils.cookieUtils.setRawCookie(BrowserAgentUtils.cookieUtils.cookies.BTRESPID,p,2,"/",null)}catch(r){e=!0,BrowserAgentLogger.error("instrumentFunc (Checkpoint # 7) : "+r.message)}var x=d.apply(this,arguments);try{!e&&f&&(h[BrowserAgentGlobals.timestampNames.END_TIME]=BrowserAgentUtils.funcUtils.endTrace(),BrowserAgentUtils.metricUtils.addDataPoint(BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.FUNCTION],
b,h),BrowserAgentUtils.metricUtils.harvestMetrics(BrowserAgentGlobals.metricType.FUNCTION)),!e&&c&&q&&(c={},c[BrowserAgentGlobals.timestampNames.END_TIME]=BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch(),BrowserAgentUtils.metricUtils.addDataPoint(BrowserAgentGlobals.ajaxSendDataMap,p,c))}catch(r){e=!0,BrowserAgentLogger.error("instrumentFunc (Checkpoint # 8): "+r.message)}return x};break;default:f=function(){var c=!1,f={};try{if(!e){(c=window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_JSFUNCTIONMETRICSENABLED])||
BrowserAgentLogger.info("JS Function Metrics are DISABLED.");if("XMLHttpRequest.prototype.open"===a){this._url=arguments[1];this._fullURL=BrowserAgentUtils.configUtils.getFullURL(this._url);this._isAjaxInstrumented=this._async=!0;3<=arguments.length&&(this._async=arguments[2]);var m=window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_AJAXMETRICSENABLED],q=BrowserAgentUtils.configUtils.isExcluded(this._fullURL);m||BrowserAgentLogger.info("AJAX Metrics are DISABLED.");q&&BrowserAgentLogger.info("AJAX URL "+
this._fullURL+" is configured to be EXCLUDED.");if(!m||q)this._isAjaxInstrumented=!1}c&&(f[BrowserAgentGlobals.timestampNames.START_TIME]=BrowserAgentUtils.funcUtils.startTrace())}}catch(h){e=!0,BrowserAgentLogger.error("instrumentFunc (Checkpoint # 9) : "+h.message)}m=d.apply(this,arguments);try{!e&&c&&(f[BrowserAgentGlobals.timestampNames.END_TIME]=BrowserAgentUtils.funcUtils.endTrace(),BrowserAgentUtils.metricUtils.addDataPoint(BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.FUNCTION],
b,f),BrowserAgentUtils.metricUtils.harvestMetrics(BrowserAgentGlobals.metricType.FUNCTION))}catch(h){e=!0,BrowserAgentLogger.error("instrumentFunc (Checkpoint # 10) : "+h.message)}return m}}BrowserAgentLogger.info("Finished Instrumentation of "+a);f&&(f._isBrowserAgentInstrumented=!0);return f},instrumentAllFunc:function(){if(BrowserAgentGlobals.functionsToInstrument){window&&window.XMLHttpRequest&&this.saveOrigObj("XHR_ctor",window.XMLHttpRequest);for(var a in BrowserAgentGlobals.functionsToInstrument)if(BrowserAgentGlobals.functionsToInstrument[a].name)try{eval("var res = BrowserAgentUtils.funcUtils.instrumentFunc(BrowserAgentGlobals.functionsToInstrument['"+
a+"'].name, '"+a+"'); if (res) { window."+BrowserAgentGlobals.functionsToInstrument[a].name+" = res; }")}catch(b){}}else BrowserAgentLogger.info("No JS functions to instrument.")},saveOrigObj:function(a,b){b&&a?Object.defineProperty(BrowserAgentGlobals.origFuncMap,a,{value:b,writable:!1,enumerable:!1,configurable:!1}):BrowserAgentLogger.warn("saveOrigObj : Cannot save original object without key or the object itself.")},startTrace:function(){return BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch()}},
metricUtils:{batchID:null,XHRToSendMetrics:null,init:function(){try{this.addMetricType("function",this.harvestFuncMetrics),this.addMetricType("ajax",this.harvestAjaxMetrics)}catch(a){BrowserAgentLogger.error("metricUtils.init : "+a.message)}},addDataPoint:function(a,b,c){this.isValid(a,b)&&null!=c&&void 0!=c&&(a[b]?a[b].push(c):a[b]=[c])},addMetricType:function(a,b){if(a&&"string"===typeof a&&BrowserAgentGlobals&&BrowserAgentGlobals.metricType&&b&&"function"===typeof b&&BrowserAgentGlobals.metricTypeToAccumulatorMap&&
BrowserAgentGlobals.metricTypeToHarvestMap){var c=a.toLowerCase();Object.defineProperty(BrowserAgentGlobals.metricType,a.toUpperCase(),{value:c,writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(BrowserAgentGlobals.metricTypeToAccumulatorMap,c,{value:{},writable:!0,enumerable:!0,configurable:!0});Object.defineProperty(BrowserAgentGlobals.metricTypeToHarvestMap,c,{value:b,writable:!0,enumerable:!0,configurable:!0})}else BrowserAgentLogger.error("addMetricType : cannot add metric type for "+
a)},constructMetricPath:function(a,b,c,d){if("string"!==typeof a||"string"!==typeof b||"number"!==typeof c||"number"!==typeof d)return BrowserAgentLogger.warn("constructMetricPath : cannot construct metric path for {"+a+", "+b+", "+c+", "+d+"}"),"";0<a.length&&(a=BrowserAgentUtils.metricUtils.metricPrefixSanitize(a)+BrowserAgentGlobals.colonChar);b=a=a+b+BrowserAgentGlobals.equalChar+BrowserAgentGlobals.openParenChar+c+BrowserAgentGlobals.commaChar+d+BrowserAgentGlobals.closedParenChar+BrowserAgentGlobals.semiColonChar;
BrowserAgentExtension&&(b=BrowserAgentExtension.extNameFormatter(a));return b},isValid:function(a,b){return b?a?"object"!==typeof a?(BrowserAgentLogger.error("isValid : Metric location must be an object"),!1):!0:(BrowserAgentLogger.error("isValid : Metric location must be defined"),!1):(BrowserAgentLogger.error("isValid : Metric key cannot be null or undefined"),!1)},isValidAjaxDataPoint:function(a){return a&&a.URL&&a[BrowserAgentGlobals.timestampNames.FIRST_BYTE]&&a[BrowserAgentGlobals.timestampNames.LAST_BYTE]&&
a[BrowserAgentGlobals.timestampNames.CALLBACK_START_TIME]&&a[BrowserAgentGlobals.timestampNames.CALLBACK_END_TIME]?!0:!1},getOptionalParameters:function(a,b,c,d,e,f){var g="";c=parseInt(c);if("1"!==a||"string"!==typeof b||!c||"number"!==typeof d||"number"!==typeof e||1>e)return g;g=BrowserAgentUtils.cookieUtils.cookieKeys.geoChar+BrowserAgentGlobals.equalChar;window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_GEOENABLED]?(BrowserAgentUtils.browserUtils.geoCookie||(BrowserAgentUtils.browserUtils.geoCookie=
BrowserAgentUtils.cookieUtils.getCookieObject(BrowserAgentUtils.cookieUtils.cookies.GEO)),g=BrowserAgentUtils.browserUtils.geoCookie?g+(BrowserAgentUtils.browserUtils.geoCookie.lat+BrowserAgentGlobals.commaChar+BrowserAgentUtils.browserUtils.geoCookie["long"]):g+("-255"+BrowserAgentGlobals.commaChar+"-255")):g+="-255"+BrowserAgentGlobals.commaChar+"-255";g+=BrowserAgentGlobals.semiColonChar;g=g+"duration="+parseInt(e)+";p="+BrowserAgentGlobals.p+";pv="+BrowserAgentGlobals.pv+";CorBrowsGUID="+b+";startTime=";
b=window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_TTSTARTTIMEADJUSTMENTENABLED];g=d>c||b&&d+e<c?g+(c-parseInt(f/2)):g+d;BrowserAgentExtension&&(g+=BrowserAgentExtension.extAddCustomOptionalProperty());return g},getPathnameFromURL:function(a){if(!a||"string"!==typeof a)return a;var b=a.indexOf(BrowserAgentGlobals.forwardSlashChar),c=BrowserAgentGlobals.forwardSlashChar;-1!==b&&(c=a.substring(b));return c},getRedefinedXHRForMetrics:function(){BrowserAgentGlobals.origFuncMap&&BrowserAgentGlobals.origFuncMap.XHR_ctor&&
BrowserAgentGlobals.origFuncMap.XHR_Open&&BrowserAgentGlobals.origFuncMap.XHR_Send?(BrowserAgentUtils.metricUtils.XHRToSendMetrics=new BrowserAgentGlobals.origFuncMap.XHR_ctor,BrowserAgentUtils.metricUtils.XHRToSendMetrics.open=BrowserAgentGlobals.origFuncMap.XHR_Open,BrowserAgentUtils.metricUtils.XHRToSendMetrics.send=BrowserAgentGlobals.origFuncMap.XHR_Send):BrowserAgentUtils.metricUtils.XHRToSendMetrics=null},harvestAjaxMetrics:function(a){var b="",c=BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.AJAX],
d=BrowserAgentGlobals.ajaxSendDataMap;if(!c||!d)return b;var e,f,g,l,m,q,h={},k,p,t,u=BrowserAgentUtils.metricUtils.convertURL(BrowserAgentUtils.metricUtils.sanitizeURL(BrowserAgentGlobals.currentURL)),x=window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_AJAXMETRICSTHRESHOLD],r=window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_URLMETRICOFF],w=BrowserAgentGlobals.metricAggregatorType.INT_LONG_DURATION,n;for(n in c){var v="";a&&(n=a);e=c[n]?c[n][0]:null;f=d[n]?d[n][0]:null;if(!e||
!f)if(a)break;else continue;if(!BrowserAgentUtils.metricUtils.isValidAjaxDataPoint(e)||!f[BrowserAgentGlobals.timestampNames.END_TIME])if(BrowserAgentLogger.warn("Obtained invalid AJAX data point. Deleting it..."),delete BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.AJAX][n],delete BrowserAgentGlobals.ajaxSendDataMap[n],a)break;else continue;g=BrowserAgentUtils.metricUtils.convertURL(BrowserAgentUtils.metricUtils.sanitizeURL(e.URL));k=e[BrowserAgentUtils.cookieUtils.cookieKeys.bsChar]&&
e[BrowserAgentUtils.cookieUtils.cookieKeys.bsChar]!==BrowserAgentGlobals.UNDEFINED?e[BrowserAgentUtils.cookieUtils.cookieKeys.bsChar]:BrowserAgentGlobals.bs;if(k===BrowserAgentGlobals.UNDEFINED&&r)if(BrowserAgentLogger.info("Skipping harvest of AJAX metrics as NON-BT based metrics are OFF"),delete BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.AJAX][n],delete BrowserAgentGlobals.ajaxSendDataMap[n],a)break;else continue;l=e[BrowserAgentGlobals.timestampNames.CALLBACK_END_TIME]-
f[BrowserAgentGlobals.timestampNames.END_TIME];if(l<x)if(BrowserAgentLogger.info("Skipping harvest of AJAX metrics for "+e.URL+" as it is below the configured AJAX Metric Threshold"),delete BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.AJAX][n],delete BrowserAgentGlobals.ajaxSendDataMap[n],a)break;else continue;p=k!==BrowserAgentGlobals.UNDEFINED&&e[BrowserAgentUtils.cookieUtils.cookieKeys.btChar]?e[BrowserAgentUtils.cookieUtils.cookieKeys.btChar]:BrowserAgentGlobals.bt;
t=k!==BrowserAgentGlobals.UNDEFINED&&e[BrowserAgentUtils.cookieUtils.cookieKeys.btcChar]?e[BrowserAgentUtils.cookieUtils.cookieKeys.btcChar]:BrowserAgentGlobals.btc;var A=BrowserAgentGlobals.UNDEFINED,y="";k===BrowserAgentGlobals.UNDEFINED&&(A=u,y=u+BrowserAgentGlobals.pipeChar);y+=BrowserAgentGlobals.metricPath.AJAX+BrowserAgentGlobals.pipeChar+g;g=e[BrowserAgentGlobals.timestampNames.FIRST_BYTE]-f[BrowserAgentGlobals.timestampNames.END_TIME];q=e[BrowserAgentGlobals.timestampNames.LAST_BYTE]-e[BrowserAgentGlobals.timestampNames.FIRST_BYTE];
m=e[BrowserAgentGlobals.timestampNames.CALLBACK_END_TIME]-e[BrowserAgentGlobals.timestampNames.CALLBACK_START_TIME];h[BrowserAgentGlobals.defaultMetricNames.AJAX_TRLT]=[l,w];h[BrowserAgentGlobals.defaultMetricNames.AJAX_TTFB]=[g,w];h[BrowserAgentGlobals.defaultMetricNames.AJAX_TTT]=[q,w];h[BrowserAgentGlobals.defaultMetricNames.AJAX_CBET]=[m,w];h[BrowserAgentGlobals.defaultMetricNames.AJAX_ICPI]=[1,BrowserAgentGlobals.metricAggregatorType.LONG_INTERVAL_COUNTER];if(BrowserAgentExtension){BrowserAgentExtension.extAddCustomAjaxMetric();
for(var B in BrowserAgentExtension.extCustomAjaxMetricMap)h[B]=BrowserAgentExtension.extCustomAjaxMetricMap[B];BrowserAgentExtension.extCustomAjaxMetricMap={}}BrowserAgentUtils.metricUtils.validateMetrics(h);for(var z in h)v+=BrowserAgentUtils.metricUtils.constructMetricPath(y,z,h[z][0],h[z][1]);f=parseInt(BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch()-BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch()+f[BrowserAgentGlobals.timestampNames.END_TIME]);e=BrowserAgentUtils.metricUtils.getOptionalParameters(e[BrowserAgentUtils.cookieUtils.cookieKeys.ttChar],
e[BrowserAgentUtils.cookieUtils.cookieKeys.CorBrowsGUIDChar],e[BrowserAgentUtils.cookieUtils.cookieKeys.apmStartTimeChar],f,l,h[BrowserAgentGlobals.defaultMetricNames.AJAX_TTFB][0]);0<v.length&&(v=BrowserAgentUtils.metricUtils.placeInPostParameterFormat(k,p,t,A,e,v),b+=v,BrowserAgentGlobals.bCount++);delete BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.AJAX][n];delete BrowserAgentGlobals.ajaxSendDataMap[n];if(a)break}return b},harvestAllMetrics:function(){try{BrowserAgentGlobals.postData=
"";for(var a in BrowserAgentGlobals.metricTypeToHarvestMap)BrowserAgentGlobals.postData+=BrowserAgentGlobals.metricTypeToHarvestMap[a]();0!==BrowserAgentGlobals.postData.length&&(BrowserAgentGlobals.postData="bCount="+BrowserAgentGlobals.bCount+BrowserAgentGlobals.postData,BrowserAgentUtils.metricUtils.sendMetrics(window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_WILYURL],BrowserAgentGlobals.postData))}catch(c){if(BrowserAgentGlobals){BrowserAgentGlobals.postData="";BrowserAgentGlobals.bCount=
0;for(var b in BrowserAgentGlobals.metricTypeToAccumulatorMap)BrowserAgentGlobals.metricTypeToAccumulatorMap[b]={}}BrowserAgentLogger.error("harvestAllMetrics : "+c.message)}},harvestFuncMetrics:function(){var a="",b=BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.FUNCTION];if(!b)return a;var c,d={},e=BrowserAgentGlobals.metricPath.FUNC,f=BrowserAgentGlobals.UNDEFINED;if(BrowserAgentGlobals.bs===BrowserAgentGlobals.UNDEFINED){if(window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_URLMETRICOFF])return BrowserAgentLogger.info("Skipping harvest of JS Function metrics as NON-BT based metrics are OFF"),
BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.FUNCTION]={},a;f=e=BrowserAgentUtils.metricUtils.convertURL(BrowserAgentUtils.metricUtils.sanitizeURL(BrowserAgentGlobals.currentURL));e+=BrowserAgentGlobals.pipeChar+BrowserAgentGlobals.metricPath.FUNC}var g=window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_JSFUNCTIONMETRICSTHRESHOLD],l;for(l in b){for(var m=0;m<b[l].length;m++)if(b[l][m][BrowserAgentGlobals.timestampNames.END_TIME]&&b[l][m][BrowserAgentGlobals.timestampNames.START_TIME])if(c=
b[l][m][BrowserAgentGlobals.timestampNames.END_TIME]-b[l][m][BrowserAgentGlobals.timestampNames.START_TIME],c<g)BrowserAgentLogger.info("Skipping harvest of JS function metrics for "+l+" as it is below the configured JS Function Metric Threshold"),delete BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.FUNCTION][l][m];else{d[BrowserAgentGlobals.defaultMetricNames.FUNC_AET]=[c,BrowserAgentGlobals.metricAggregatorType.INT_LONG_DURATION];d[BrowserAgentGlobals.defaultMetricNames.FUNC_ICPI]=
[1,BrowserAgentGlobals.metricAggregatorType.LONG_INTERVAL_COUNTER];if(BrowserAgentExtension){BrowserAgentExtension.extAddCustomJSFuncMetric();for(var q in BrowserAgentExtension.extCustomJSFuncMetricMap)d[q]=BrowserAgentExtension.extCustomJSFuncMetricMap[q];BrowserAgentExtension.extCustomJSFuncMetricMap={}}BrowserAgentUtils.metricUtils.validateMetrics(d);for(var h in d)a+=BrowserAgentUtils.metricUtils.constructMetricPath(e+BrowserAgentGlobals.pipeChar+l,h,d[h][0],d[h][1])}else BrowserAgentLogger.warn("Obtained invalid JavaScript Function data point. Deleting it..."),
delete BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.FUNCTION][l][m];delete BrowserAgentGlobals.metricTypeToAccumulatorMap[BrowserAgentGlobals.metricType.FUNCTION][l]}0<a.length&&(a=BrowserAgentUtils.metricUtils.placeInPostParameterFormat(BrowserAgentGlobals.bs,BrowserAgentGlobals.bt,BrowserAgentGlobals.btc,f,"",a),BrowserAgentGlobals.bCount++);return a},harvestMetrics:function(a,b){try{var c=window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_METRICFREQUENCY];
0<c?BrowserAgentUtils.metricUtils.batchID||(BrowserAgentUtils.metricUtils.batchID=setInterval(BrowserAgentUtils.metricUtils.harvestAllMetrics,c)):(BrowserAgentUtils.metricUtils.batchID&&(clearInterval(BrowserAgentUtils.metricUtils.batchID),BrowserAgentUtils.metricUtils.batchID=null),a&&"string"===typeof a?(BrowserAgentGlobals.postData="",BrowserAgentGlobals.postData+=BrowserAgentGlobals.metricTypeToHarvestMap[a](b),0<BrowserAgentGlobals.postData.length&&(BrowserAgentGlobals.postData="bCount="+BrowserAgentGlobals.bCount+
BrowserAgentGlobals.postData,BrowserAgentUtils.metricUtils.sendMetrics(window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_WILYURL],BrowserAgentGlobals.postData))):BrowserAgentLogger.warn("harvestMetrics : cannot harvest metrics for metric type "+a))}catch(e){if(BrowserAgentGlobals){BrowserAgentGlobals.postData="";BrowserAgentGlobals.bCount=0;for(var d in BrowserAgentGlobals.metricTypeToAccumulatorMap)BrowserAgentGlobals.metricTypeToAccumulatorMap[d]={}}BrowserAgentLogger.error("harvestMetrics : "+
e.message)}},harvestPageMetrics:function(){var a="";if(BROWSERAGENT.tOnLoad<window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_PAGELOADMETRICSTHRESHOLD])return BrowserAgentLogger.info("Skipping harvest of Page metrics for as it is below the configured Page Metric Threshold"),a;var b="",c=BrowserAgentGlobals.UNDEFINED;if(BrowserAgentGlobals.bs===BrowserAgentGlobals.UNDEFINED){if(window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_URLMETRICOFF])return BrowserAgentLogger.info("Skipping harvest of Page metrics as NON-BT based metrics are OFF"),
a;c=b=BrowserAgentUtils.metricUtils.convertURL(BrowserAgentUtils.metricUtils.sanitizeURL(BrowserAgentGlobals.currentURL))}var d={},e=BrowserAgentGlobals.metricAggregatorType.INT_LONG_DURATION;d[BrowserAgentGlobals.defaultMetricNames.NTAPI_ABRT]=[BROWSERAGENT.tBRT,e];d[BrowserAgentGlobals.defaultMetricNames.NTAPI_ACET]=[BROWSERAGENT.tConn,e];d[BrowserAgentGlobals.defaultMetricNames.NTAPI_ADNSLT]=[BROWSERAGENT.tDNS,e];d[BrowserAgentGlobals.defaultMetricNames.NTAPI_ADCT]=[BROWSERAGENT.tDomReady,e];d[BrowserAgentGlobals.defaultMetricNames.NTAPI_APLCT]=
[BROWSERAGENT.tOnLoad,e];d[BrowserAgentGlobals.defaultMetricNames.NTAPI_APPUT]=[BROWSERAGENT.tUnload,e];d[BrowserAgentGlobals.defaultMetricNames.NTAPI_ARTT]=[BROWSERAGENT.tRTT,e];d[BrowserAgentGlobals.defaultMetricNames.NTAPI_ATTFB]=[BROWSERAGENT.tFirstByte,e];d[BrowserAgentGlobals.defaultMetricNames.NTAPI_ATTLB]=[BROWSERAGENT.tLastByte,e];d[BrowserAgentGlobals.defaultMetricNames.OTHER_RPI]=[1,BrowserAgentGlobals.metricAggregatorType.LONG_INTERVAL_COUNTER];if(BrowserAgentExtension){BrowserAgentExtension.extAddCustomPageMetric();
for(var f in BrowserAgentExtension.extCustomPageMetricMap)d[f]=BrowserAgentExtension.extCustomPageMetricMap[f];BrowserAgentExtension.extCustomPageMetricMap={}}BrowserAgentUtils.metricUtils.validateMetrics(d);BrowserAgentLogger.info(" ####### PAGE TIMINGS #######");for(var g in d)BrowserAgentLogger.info(g+" = "+d[g][0]);e=BrowserAgentUtils.metricUtils.getOptionalParameters(BrowserAgentGlobals.c,BrowserAgentGlobals.CorBrowsGUID,BrowserAgentGlobals.startTime,BROWSERAGENT.cookie.bts,BROWSERAGENT.tOnLoad,
d[BrowserAgentGlobals.defaultMetricNames.NTAPI_ATTFB][0]);for(g in d)a+=BrowserAgentUtils.metricUtils.constructMetricPath(b,g,d[g][0],d[g][1]);0<a.length&&(a=BrowserAgentUtils.metricUtils.placeInPostParameterFormat(BrowserAgentGlobals.bs,BrowserAgentGlobals.bt,BrowserAgentGlobals.btc,c,e,a),BrowserAgentGlobals.bCount++);return a},metricPrefixSanitize:function(a){if(!a||"string"!==typeof a)return BrowserAgentLogger.warn("metricPrefixSanitize : cannot sanitize metrics for "+a),a;var b=a;a&&(b=b.replace(/:/g,
"_"));return b},convertURL:function(a){if(!a||"string"!==typeof a||1>a.length)return BrowserAgentLogger.warn("convertURL : cannot convert URL - "+a),a;var b=a.indexOf(BrowserAgentGlobals.forwardSlashChar);a=a.replace(/:/g,"/");var c=a+BrowserAgentGlobals.pipeChar+BrowserAgentGlobals.forwardSlashChar;-1!==b&&(c=a.substring(0,b)+BrowserAgentGlobals.pipeChar+a.substring(b));return c},placeInPostParameterFormat:function(a,b,c,d,e,f){if("string"!==typeof f||1>f.length)return"";if("string"!==typeof a||
"string"!==typeof b||"string"!==typeof c)c=b=a=BrowserAgentGlobals.UNDEFINED;"string"!==typeof d&&(d="");"string"!==typeof e&&(e="");return BrowserAgentGlobals.ampersandChar+"b"+BrowserAgentGlobals.bCount+BrowserAgentGlobals.equalChar+e+BrowserAgentGlobals.dollarChar+BrowserAgentUtils.cookieUtils.cookieKeys.bsChar+BrowserAgentGlobals.equalChar+a+BrowserAgentGlobals.commaChar+BrowserAgentUtils.cookieUtils.cookieKeys.btChar+BrowserAgentGlobals.equalChar+b+BrowserAgentGlobals.commaChar+BrowserAgentUtils.cookieUtils.cookieKeys.btcChar+
BrowserAgentGlobals.equalChar+c+BrowserAgentGlobals.commaChar+BrowserAgentGlobals.urlChar+BrowserAgentGlobals.equalChar+d+BrowserAgentGlobals.semiColonChar+f.substr(0,f.length-1)},resetAccumulator:function(a){a&&"string"===typeof a&&BrowserAgentGlobals&&BrowserAgentGlobals[a]?BrowserAgentGlobals[a]={}:BrowserAgentLogger.warn("resetAccumulator : could not rest accumulator "+a)},sanitizeURL:function(a){if(!a||"string"!==typeof a)return BrowserAgentLogger.warn("sanitizeURL : cannot clean up URL - "+
a),a;a=decodeURIComponent(a);var b=a.indexOf("?");-1!==b&&(a=a.substring(0,b));b=a.indexOf("#");a&&-1!==b&&(a=a.substring(0,b));b=a.indexOf(BrowserAgentGlobals.semiColonChar);a&&-1!==b&&(a=a.substring(0,b));b=80;a&&(-1!==a.search(/^(http|https):/g)?(-1!==a.indexOf("https")&&(b=443),a=a.replace(/(http|https):\/\//g,"")):a=0===a.indexOf("/")?window.location.host+a:window.location.host+"/"+a);var c=a.indexOf(BrowserAgentGlobals.forwardSlashChar),d=-1!==c?a.substring(0,c):a;-1===d.indexOf(":")&&(d=d+
":"+b);(a=-1!==c?d+a.substring(c):d)&&(a=a.replace(/^\/|\/$/g,""));return a},sendMetrics:function(a,b){if(a&&b&&"string"===typeof a){BrowserAgentUtils.metricUtils.getRedefinedXHRForMetrics();var c=BrowserAgentUtils.metricUtils.XHRToSendMetrics;c&&(c.open("POST",a,!0),c.onreadystatechange=function(){this.readyState===this.DONE&&0===this.status&&(BrowserAgentLogger.error("sendMetrics : BrowserAgent Metrics Send Error. Browser is most likely discarding them."),BrowserAgentGlobals.bCount=0,BrowserAgentGlobals.postData=
"")},c.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8"),c.send(b),BrowserAgentLogger.info("Sending POST with {{ "+b+" }}"))}else BrowserAgentLogger.warn("sendMetrics : Cannot send BrowserAgent Metrics to URL: "+a+" with data as {{ "+b+" }}.");BrowserAgentGlobals.bCount=0;BrowserAgentGlobals.postData=""},validateMetrics:function(a){if(a&&"object"===typeof a){var b,c;for(c in a)a[c]&&2===a[c].length?(b=a[c][0],null==b||void 0==b||"number"!==typeof b||0>b||isNaN(b)?
(BrowserAgentLogger.warn("validateMetrics : Obtained metric out of range : "+c+". Zeroing it out..."),a[c][0]=0):a[c][0]=parseInt(a[c][0])):(a[c]=[0,BrowserAgentGlobals.metricAggregatorType.INT_LONG_DURATION],BrowserAgentLogger.warn("validateMetrics : invalid metric format. Zeroing it out and defaulting metric aggregator to INT_LONG_DURATION..."))}else BrowserAgentLogger.warn("validateMetrics : cannot validate metrics for undefined metric object")}},timeUtils:{getCurrTime:function(){return new Date},
getCurrTimeInMillis:function(){return BrowserAgentUtils.BrowserAgentTimer?BrowserAgentUtils.BrowserAgentTimer.now():(BrowserAgentLogger.warn("getCurrTimeInMillis: BrowserAgent Timer is not present."),0)},getCurrTimeInMillisSinceEpoch:function(){return(new Date).getTime()},getTimerObj:function(){var a=window.performance||{};a.now=function(){return a.now||a.webkitNow||a.msNow||a.oNow||a.mozNow||function(){return(new Date).getTime()}}();return a}}},BrowserAgentGlobals={ajaxSendDataMap:{},ampersandChar:"&",
bCount:0,bs:"-1",bt:"-1",btc:"-1",BussSeg:"Business Segment",c:"0",closedParenChar:")",colonChar:":",commaChar:",",CookiePath:window.location.pathname,CorBrowsGUID:null,currentURL:window.location.protocol+"//"+window.location.host+window.location.pathname,currentFullURL:window.location.href,defaultMetricNames:{NTAPI_ABRT:"Average Browser Render Time (ms)",NTAPI_ADCT:"Average DOM Construction Time (ms)",NTAPI_APLCT:"Average Page Load Complete Time (ms)",NTAPI_APPUT:"Average Previous Page Unload Time (ms)",
NTAPI_ARTT:"Average Round Trip Time (ms)",NTAPI_ADNSLT:"Average DNS Lookup Time (ms)",NTAPI_ATTFB:"Average Time to First Byte (ms)",NTAPI_ATTLB:"Average Time to Last Byte (ms)",NTAPI_ACET:"Average Connection Establishment Time (ms)",OTHER_RPI:"Responses Per Interval",FUNC_AET:"Average Execution Time (ms)",FUNC_ICPI:"Invocation Count Per Interval",AJAX_TRLT:"Total Resource Load Time (ms)",AJAX_TTFB:"Time To First Byte (ms)",AJAX_TTT:"Response Download Time (ms)",AJAX_CBET:"Callback Execution Time (ms)",
AJAX_ICPI:"Invocation Count Per Interval",AJAX_NSHPI:"Non-Server Hits Per Interval"},dollarChar:"$",equalChar:"=",forwardSlashChar:"/",functionsToInstrument:{},openParenChar:"(",metricAggregatorType:{INT_LONG_DURATION:0,LONG_INTERVAL_COUNTER:1},metricPath:{BROWSER:"Browser",AJAX:"AJAX Call",FUNC:"JavaScript Function",URL:"URL"},metricType:{},metricTypeToAccumulatorMap:{},metricTypeToHarvestMap:{},origFuncMap:{},p:"-1",platformNames:{CHROME:"Chrome",FIREFOX:"Firefox",IE:"IE",SAFARI:"Safari",EDGE:"Edge"},
pv:"-1",timestampNames:{START_TIME:"s",END_TIME:"e",CALLBACK_START_TIME:"cs",CALLBACK_END_TIME:"ce",FIRST_BYTE:"f",LAST_BYTE:"l",EXTERNAL:"ex"},pipeChar:"|",postData:"",semiColonChar:";",startTime:null,UNDEFINED:"-1",urlChar:"url"},BROWSERAGENT={bts:0,cookie:null,document:document,dts:0,ets:0,method:"",navTiming:null,sts:0,tBRT:-1,tConn:-1,tDNS:-1,tDomLoading:-1,tDomReady:-1,tFirstByte:-1,tLastByte:-1,tOnLoad:-1,tRTT:-1,tUnload:-1,window:window,init:function(){BrowserAgentUtils.init();BrowserAgentUtils.configUtils.isPageExcluded||
(window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_PAGELOADMETRICSENABLED]?(BROWSERAGENT.navTiming=this.window.performance||this.window.msPerformance||this.window.webkitPerformance||this.window.mozPerformance,BROWSERAGENT.navTiming&&BROWSERAGENT.navTiming.timing?(BrowserAgentLogger.info("Navigation Timing API is present."),BrowserAgentLogger.info("Attaching to onload event..."),this.attachEvent(this.window,"load",function(){BrowserAgentUtils.cookieUtils.updateCookie(BrowserAgentUtils.cookieUtils.cookies.GLOBAL,
{bts:BROWSERAGENT.navTiming.timing.navigationStart,sts:BROWSERAGENT.navTiming.timing.unloadEventEnd});BROWSERAGENT.dts=BROWSERAGENT.navTiming.timing.domContentLoadedEventStart;BROWSERAGENT.ets=BROWSERAGENT.navTiming.timing.loadEventStart;BROWSERAGENT.onload()},!1),BrowserAgentLogger.info("Attaching to onbeforeunload event..."),this.attachEvent(this.window,"beforeunload",function(){BrowserAgentUtils.cookieUtils.setSelfInstrumentedCookie("false")},!0)):(BrowserAgentLogger.info("Navigation Timing API is NOT present. Resorting to alternatives..."),
document.onreadystatechange=function(){"complete"==document.readyState&&(BROWSERAGENT.dts=BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch())},BrowserAgentLogger.info("Attaching to onbeforeunload event..."),this.attachEvent(this.window,"beforeunload",BROWSERAGENT.beforeunload,!0),BrowserAgentLogger.info("Attaching to pagehide event..."),window.addEventListener("pagehide",function(){BrowserAgentLogger.info("Detected pagehide event...");BrowserAgentUtils.cookieUtils.setSelfInstrumentedCookie("false")},
!1),BrowserAgentLogger.info("Attaching to onunload event..."),this.attachEvent(this.window,"unload",BROWSERAGENT.unload,!1),BrowserAgentLogger.info("Attaching to onload event..."),this.attachEvent(this.window,"load",BROWSERAGENT.onload,!0)),BrowserAgentExtension&&BrowserAgentExtension.init()):BrowserAgentLogger.info("Skipping page instrumentation because Page Load Metrics are DISABLED"))},attachEvent:function(a,b,c,d){d=d||!1;return this.window.addEventListener?(a.addEventListener(b,c,d),!0):this.window.attachEvent?
("DOMContentLoaded"==b?this.ieContentLoaded(this.window,c):a.attachEvent("on"+b,c)||BrowserAgentLogger.warn("attachEvent failed"),!0):!1},beforeunload:function(){BrowserAgentLogger.info("Detected 'onbeforeunload' event...");BrowserAgentUtils.cookieUtils.setSelfInstrumentedCookie("false");BROWSERAGENT.bts=BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch();BrowserAgentUtils.cookieUtils.updateCookie(BrowserAgentUtils.cookieUtils.cookies.GLOBAL,{bts:BROWSERAGENT.bts})},ieContentLoaded:function(a,
b){var c=a.document,d=!1;(function(){try{c.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,50);return}d||(d=!0,b())})();c.onreadystatechange=function(){"complete"===c.readyState&&(c.onreadystatechange=null,d||(d=!0,b()))}},onload:function(){BrowserAgentLogger.info("Detected 'onload' event...");var a=BrowserAgentUtils.cookieUtils.getRawCookie(BrowserAgentUtils.cookieUtils.cookies.BTPAGERESP);a||(a=BrowserAgentUtils.cookieUtils.getRawCookie(BrowserAgentUtils.cookieUtils.cookies.BTRESP));
a&&(a=BrowserAgentUtils.cookieUtils.tokenizeCookieIntoMap(a,","),BrowserAgentUtils.cookieUtils.updateObjWithCookieDataPage(a));BrowserAgentUtils.cookieUtils.setBrowserAgentGlobalDataCookie();BROWSERAGENT.ets=BROWSERAGENT.ets||BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch();BROWSERAGENT.cookie=BrowserAgentUtils.cookieUtils.getCookieObject();BROWSERAGENT.navTiming&&BROWSERAGENT.navTiming.timing?(BROWSERAGENT.tDomLoading=BROWSERAGENT.navTiming.timing.domLoading-BROWSERAGENT.navTiming.timing.navigationStart,
BROWSERAGENT.tRTT=BROWSERAGENT.navTiming.timing.responseEnd-BROWSERAGENT.navTiming.timing.requestStart,BROWSERAGENT.tDNS=BROWSERAGENT.navTiming.timing.domainLookupEnd-BROWSERAGENT.navTiming.timing.domainLookupStart,BROWSERAGENT.tConn=BROWSERAGENT.navTiming.timing.connectEnd-BROWSERAGENT.navTiming.timing.connectStart,BROWSERAGENT.tFirstByte=BROWSERAGENT.navTiming.timing.responseStart-BROWSERAGENT.navTiming.timing.navigationStart,BROWSERAGENT.tLastByte=BROWSERAGENT.navTiming.timing.responseEnd-BROWSERAGENT.navTiming.timing.navigationStart):
BROWSERAGENT.cookie&&0<BROWSERAGENT.dts&&0<BROWSERAGENT.cookie.bts&&0<BROWSERAGENT.dts-BROWSERAGENT.cookie.bts&&(BROWSERAGENT.tDomLoading=BROWSERAGENT.dts-BROWSERAGENT.cookie.bts);-1<BROWSERAGENT.document.referrer.indexOf(BROWSERAGENT.document.domain)&&BROWSERAGENT.cookie?(BROWSERAGENT.tUnload=0,BROWSERAGENT.cookie.sts&&BROWSERAGENT.cookie.bts&&(BROWSERAGENT.tUnload=BROWSERAGENT.cookie.sts-BROWSERAGENT.cookie.bts),BROWSERAGENT.tDomReady=0,0!=BROWSERAGENT.dts&&BROWSERAGENT.cookie.bts&&(BROWSERAGENT.tDomReady=
BROWSERAGENT.dts-BROWSERAGENT.cookie.bts),BROWSERAGENT.tOnLoad=0,BROWSERAGENT.cookie.bts&&(BROWSERAGENT.tOnLoad=BROWSERAGENT.ets-BROWSERAGENT.cookie.bts),BROWSERAGENT.method="beforeunload"):BROWSERAGENT.cookie&&0<BROWSERAGENT.cookie.bts&&-1==BROWSERAGENT.document.referrer.indexOf(BROWSERAGENT.document.domain)&&(BROWSERAGENT.tUnload=0,BROWSERAGENT.cookie.bts&&BROWSERAGENT.cookie.sts&&0<BROWSERAGENT.cookie.sts&&(BROWSERAGENT.tUnload=BROWSERAGENT.cookie.sts-BROWSERAGENT.cookie.bts),BROWSERAGENT.tDomReady=
0,0!=BROWSERAGENT.dts&&BROWSERAGENT.cookie.bts&&(BROWSERAGENT.tDomReady=BROWSERAGENT.dts-BROWSERAGENT.cookie.bts),BROWSERAGENT.tOnLoad=0,BROWSERAGENT.cookie.bts&&(BROWSERAGENT.tOnLoad=BROWSERAGENT.ets-BROWSERAGENT.cookie.bts),BROWSERAGENT.method="initial");BROWSERAGENT.method?(BROWSERAGENT.tBRT=BROWSERAGENT.tOnLoad-BROWSERAGENT.tDomLoading,a=BrowserAgentUtils.metricUtils.harvestPageMetrics(),0!==a.length&&(a="bCount="+BrowserAgentGlobals.bCount+a,BrowserAgentUtils.metricUtils.sendMetrics(window[BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_WILYURL],
a))):BrowserAgentLogger.warn("no method determined");BrowserAgentUtils.cookieUtils.updateCookie(BrowserAgentUtils.cookieUtils.cookies.GLOBAL,{sts:null,bts:null,dts:null});BROWSERAGENT.sts=0;BROWSERAGENT.bts=0;BROWSERAGENT.dts=0},unload:function(){BrowserAgentLogger.info("Detected 'onunload' event...");0===BROWSERAGENT.bts&&(BROWSERAGENT.bts=BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch(),BrowserAgentUtils.cookieUtils.updateCookie(BrowserAgentUtils.cookieUtils.cookies.GLOBAL,{bts:BROWSERAGENT.bts}));
BROWSERAGENT.sts=BrowserAgentUtils.timeUtils.getCurrTimeInMillisSinceEpoch();BrowserAgentUtils.cookieUtils.updateCookie(BrowserAgentUtils.cookieUtils.cookies.GLOBAL,{sts:BROWSERAGENT.sts})}};BrowserAgentUtils.configUtils.getConfig(BrowserAgentUtils.configUtils.configNames.BROWSERAGENT_ENABLED)&&BROWSERAGENT.init()}catch(a){window.console&&"object"==typeof window.console&&window.console.log(a.message)};
